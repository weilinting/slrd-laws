<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="utf-8">
<title>Law Search</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:Arial, sans-serif;padding:20px}
  .container{border:2px solid #000;padding:18px;display:inline-block}
  label{display:inline-block;width:180px;vertical-align:top;margin-bottom:8px}
  select,input[type="text"],button{padding:6px;width:260px;box-sizing:border-box}
  button{width:auto;margin-left:4px}
  #results{margin-top:18px;max-width:740px}
  .result{padding:10px;border-bottom:1px solid #ddd}
  .result a{display:block;margin-top:6px}
  mark{background:yellow}
  #status{color:gray;margin-bottom:8px}
</style>
</head>
<body>

<div class="container">
  <div>
    <label for="combo">ဥပဒေရွေးချယ်ရန်</label>
    <select id="combo"><option value="">(ရွေးပါ)</option></select>
  </div>

  <div>
    <label for="textInput">စာသား(keyword)ဖြင့်ရှာရန်</label>
    <input type="text" id="textInput" placeholder="စာရိုက်ပါ...">
  </div>

  <div style="margin-top:10px">
    <button id="searchBtn">Search</button>
  </div>

  <div id="status">Loading list…</div>
</div>

<div id="results"></div>

<script>
const combo = document.getElementById('combo');
const searchBtn = document.getElementById('searchBtn');
const textInput = document.getElementById('textInput');
const resultsEl = document.getElementById('results');
const status = document.getElementById('status');
let manifest = [];

fetch('manifest.json')
  .then(r => r.json())
  .then(data => {
    manifest = data;
    data.forEach(item => {
      const opt = document.createElement('option');
      opt.value = item.file;
      opt.textContent = item.title;
      combo.appendChild(opt);
    });
    status.textContent = 'Ready.';
  })
  .catch(err => {
    console.error(err);
    status.textContent = 'Cannot load manifest.json.';
  });

function createSnippets(text, keyword, file) {
  const lower = text.toLowerCase();
  const q = keyword.toLowerCase();
  let pos = 0;
  const results = [];
  while ((pos = lower.indexOf(q, pos)) !== -1) {
    const start = Math.max(0, pos - 80);
    const end = Math.min(text.length, pos + keyword.length + 80);
    let snippet = text.substring(start, end).replace(/\s+/g,' ');
    const re = new RegExp(keyword, 'ig');
    snippet = snippet.replace(re, m => `<mark>${m}</mark>`);
    results.push({ snippet, file });
    pos += keyword.length;
    if (results.length > 100) break;
  }
  return results;
}

function searchFile(fileUrl, keyword) {
  return fetch(fileUrl)
    .then(r => r.text())
    .then(text => createSnippets(text, keyword, fileUrl))
    .catch(err => {
      console.error('Error fetching', fileUrl, err);
      return [];
    });
}

searchBtn.addEventListener('click', async () => {
  const file = combo.value;
  const keyword = textInput.value.trim();
  resultsEl.innerHTML = '';
  if (!file) { alert('ဥပဒေတစ်ခုရွေးပါ'); return; }
  if (keyword.length < 2) { alert('အနည်းဆုံးစာလုံး ၂ လုံးရိုက်ပါ'); return; }
  status.textContent = 'Searching...';
  const matches = await searchFile(file, keyword);
  if (matches.length === 0) {
    resultsEl.innerHTML = '<div>မတွေ့ပါ</div>';
  } else {
    resultsEl.innerHTML = matches.map(m =>
      `<div class="result">...${m.snippet}... <a href="${m.file}" target="_blank">Read full law</a></div>`
    ).join('');
  }
  status.textContent = 'Done.';
});
</script>

</body>
</html>
